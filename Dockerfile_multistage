# ---- 构建阶段 (Build Stage) ----
FROM node:25-alpine AS builder

# 设置工作目录
WORKDIR /app

# 复制 package.json 文件以利用 Docker 的缓存机制
COPY package*.json ./
COPY client/package*.json client/

# 安装客户端依赖
RUN npm install

# 复制客户端源代码
COPY client/ client/

# 构建 React 应用
RUN npm run build

# ---- 运行阶段 (Production Stage) ----
FROM nginx:1.29.4-alpine

# 将构建阶段生成的静态文件复制到 Nginx 的默认网站根目录
COPY --from=builder /app/client/build /usr/share/nginx/html

# 将我们自定义的 Nginx 配置文件复制到容器中
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 暴露 Nginx 使用的 80 端口
EXPOSE 80

